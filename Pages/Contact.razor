@page "/contact"
@inject HttpClient Http

<PageTitle>Contact Me</PageTitle>

<div class="container mt-5" style="max-width: 600px;">
    <h2 class="mb-4 text-center fw-bold">Get In Touch</h2>
    <p class="text-center text-muted mb-5">Have a question or want to discuss a project? Drop me a message below.</p>

    @if (submitted)
    {
        <div class="alert alert-success text-center p-5 shadow-sm">
            <h1 class="display-1">ðŸš€</h1>
            <h4 class="mt-3">Message Sent!</h4>
            <p>Thanks for reaching out. I'll get back to you shortly.</p>
            <button class="btn btn-outline-primary mt-3" @onclick="ResetForm">Send Another</button>
        </div>
    }
    else
    {
        <EditForm Model="@contact" OnValidSubmit="@HandleSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Your Email</label>
                        <InputText @bind-Value="contact.Email" class="form-control" placeholder="name@example.com" />
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Message</label>
                        <InputTextArea @bind-Value="contact.Message" class="form-control" rows="5" placeholder="Hi David, I saw your portfolio and..." />
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" disabled="@isSubmitting">
                            @if (isSubmitting)
                            {
                                <span class="spinner-border spinner-border-sm me-2"></span> <span>Sending...</span>
                            }
                            else
                            {
                                <span>Send Message</span>
                            }
                        </button>
                    </div>
                </div>
            </div>
        </EditForm>
    }
</div>

@code {
    private ContactModel contact = new();
    private bool isSubmitting = false;
    private bool submitted = false;

    private async Task HandleSubmit()
    {
        isSubmitting = true;
        
        // REPLACE THIS URL WITH YOUR REAL FORMSPREE URL
        var url = "https://formspree.io/f/mojjqvqd"; 
        
        var jsonContent = JsonContent.Create(new 
        { 
            email = contact.Email, 
            message = contact.Message 
        });

        try
        {
            var response = await Http.PostAsync(url, jsonContent);
            if (response.IsSuccessStatusCode)
            {
                submitted = true;
            }
            else
            {
                Console.WriteLine("Error sending email");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
        finally
        {
            isSubmitting = false;
        }
    }

    private void ResetForm()
    {
        contact = new ContactModel();
        submitted = false;
    }

    public class ContactModel
    {
        public string Email { get; set; } = "";
        public string Message { get; set; } = "";
    }
}